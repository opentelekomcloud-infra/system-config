{% import 'macros.j2' as mcr %}
{% include '_annotations.yaml.j2' %}
description: Data for the Network service
editable: true
panels:
{% include '_header.yaml.j2' %}

{% include '_service_header.yaml.j2' %}

  - datasource: apimon
    fill: 1
    gridPos:
      h: 9
      w: 24
      x: 0
      y: 6
    legend:
      show: true
      alignAsTable: true
      rightSide: true
      values: true
      current: true
    lines: true
    linewidth: 1
    nullPointMode: connected
    options:
      alertThreshold: true
    renderer: flot
    spaceLength: 10
    targets:
      - refId: A
        target: aliasByNode(stats.timers.apimon.metric.$environment.$zone.csm_lb_timings.public.*.*.mean, 8, 9)
    title: LoadBalancer Latency
    type: graph
    xaxis:
      mode: time
      show: true
    yaxes:
      - format: ms
        logBase: 1
        show: true
      - show: false

  - datasource: apimon
    description: |
      Curl like request latencies to the hosts in scenario30_domains.yaml
    fill: 1
    gridPos:
      h: 6
      w: 12
      x: 0
      y: 15
    legend:
      show: true
      alignAsTable: true
      rightSide: true
      values: true
      current: true
    lines: true
    linewidth: 1
    nullPointMode: connected
    options:
      alertThreshold: true
    renderer: flot
    spaceLength: 10
    targets:
      - refId: A
        target: aliasByNode(stats.timers.apimon.metric.$environment.$zone.curl.*.{2*,3*}.mean, 5, 7)
    title: Domains curl Latency
    thresholds: 
      - value: 300
        colorMode: "warning"
        op: "gt"
        fill: true
        line: true
        yaxis: "left"
      - value: 500
        colorMode: "critical"
        op: "gt"
        fill: true
        line: true
        yaxis: "left"
    type: graph
    xaxis:
      mode: time
      show: true
    yaxes:
      - format: ms
        min: 0
        show: true
      - show: false

  - datasource: apimon
    description: |
      Curl like request errors for the hosts in scenario30_domains.yaml
    fill: 1
    gridPos:
      h: 6
      w: 6
      x: 12
      y: 15
    legend:
      show: true
    points: true
    pointRadius: 1
    nullPointMode: connected
    options:
      alertThreshold: true
    renderer: flot
    spaceLength: 10
    targets:
      - refId: A
        target: aliasByNode(stats.counters.apimon.metric.$environment.$zone.curl.*.{4*,5*}.attempted.count, 7, 8)
    title: Domains curl 4XX, 5XX Errros
    type: graph
    xaxis:
      mode: time
      show: true
    yaxes:
      - show: false
      - show: false

  - datasource: apimon
    description: |
      Curl like request connection errors for the hosts in scenario30_domains.yaml
    fill: 1
    gridPos:
      h: 6
      w: 6
      x: 18
      y: 15
    legend:
      show: true
    points: true
    pointRadius: 1
    nullPointMode: connected
    options:
      alertThreshold: true
    renderer: flot
    spaceLength: 10
    targets:
      - refId: A
        target: aliasByNode(stats.counters.apimon.metric.$environment.$zone.curl.*.failed.count, 7)
    title: Domains curl Connection Errros
    type: graph
    xaxis:
      mode: time
      show: true
    yaxes:
      - show: false
      - show: false

{{ mcr.service_api_latency('network', 17) }}
{{ mcr.service_bad_calls('network', 25) }}
{{ mcr.service_failures(33) }}
{{ mcr.service_results(43) }}

refresh: false
style: dark
tags:
  - network
  - apimon
templating:
  list:
{% include '_template_env.yaml.j2' %}
{% include '_template_zone.yaml.j2' %}
      multi: true

{{ mcr.service_scenarios_template(['scenario2_simple_ecs.yaml',
'scenario2a_ecs_az.yaml', 'scenario19_simple_vpc.yaml',
'scenario30_domains.yaml', 'lb_monitoring.yaml']) }}

time:
  from: now-6h
  to: now
timepicker:
  refresh_intervals:
    - 10s
    - 30s
    - 1m
    - 5m
    - 15m
    - 30m
    - 1h
    - 2h
    - 1d
timezone: ''
title: Network Service statistics
uid: fWvz58Awk
