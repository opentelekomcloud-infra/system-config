{% if container_command == 'podman' %}
# telegraf.service
# autogenerated by Podman 3.2.3
# Mon Sep 27 07:11:04 UTC 2021

[Unit]
Description=Podman telegraf.service
Documentation=man:telegraf-generate-systemd(1)
Wants=network.target
After=network-online.target
RequiresMountsFor=%t/containers

[Service]
Environment=TELEGRAF_SYSTEMD_UNIT=%n
Restart=on-failure
TimeoutStopSec=70

ExecStartPre=-/bin/rm -f %t/container-telegraf.pid %t/container-telegraf.ctr-id

ExecStart=/usr/bin/podman run \
          --conmon-pidfile %t/container-telegraf.pid \
          --cidfile %t/container-telegraf.ctr-id \
          --cgroups=no-conmon \
          -d \
          --name telegraf \
          -p 8888:8888 \
          --log-opt=path=/dev/null \
          -v /etc/telegraf:/etc/telegraf:ro \
          -v /:/rootfs:ro -e HOST_MOUNT_PREFIX=/rootfs -e HOST_PROC=/rootfs/proc \
          {{ telegraf_image }}

ExecStop=/usr/bin/podman stop --ignore --cidfile %t/container-telegraf.ctr-id -t 10

ExecStopPost=/usr/bin/podman rm --ignore -f --cidfile %t/container-telegraf.ctr-id

PIDFile=%t/container-telegraf.pid
Type=forking

[Install]
WantedBy=multi-user.target default.target

{% else %}
# telegraf.service

[Unit]
Description=telegraf.service
Wants=network.target
After=network-online.target

[Service]
Restart=on-failure
TimeoutStopSec=70

ExecStart=/usr/bin/docker run  \
          --name telegraf \
          -p 8888:8888 \
          -v /etc/telegraf:/etc/telegraf:ro \
          -v /:/rootfs:ro -e HOST_MOUNT_PREFIX=/rootfs -e HOST_PROC=/rootfs/proc \
          {{ telegraf_image }}

ExecStop=/usr/bin/docker stop telegraf -t 10

ExecStopPost=/usr/bin/docker rm -f telegraf

[Install]
WantedBy=multi-user.target default.target
{% endif %}
