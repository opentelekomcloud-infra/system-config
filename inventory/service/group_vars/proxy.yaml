proxy_backends:
  - name: "graphite-apimon"
    options:
      # NOTE: try to perform simliest query
      - "httpchk HEAD /metrics/find?query=*"
    domain_names:
      - "graphite.eco.tsi-dev.otc-service.com"
      - "graphite1.eco.tsi-dev.otc-service.com"
      - "graphite2.eco.tsi-dev.otc-service.com"
      - "graphite3.eco.tsi-dev.otc-service.com"
    servers:
      - name: "graphite1"
        address: "192.168.191.55:80"
        opts: "verify none cookie graphite1 check sni req.hdr(Host)"
          #      - name: "graphite2"
          #        address: "192.168.14.159:443"
          #        opts: "ssl verify none cookie graphite2 check sni req.hdr(Host)"
      - name: "graphite3"
        address: "192.168.151.11:443"
        opts: "ssl verify none cookie graphite3 check sni req.hdr(Host)"

  - name: "graphite-ca"
    options:
      - "httpchk HEAD /metrics/lb_check"
    domain_names:
      - "graphite-ca.eco.tsi-dev.otc-service.com"
    servers:
      - name: "graphite-otcinfra"
        address: "192.168.170.249:443"
        opts: "ssl verify none cookie graphite-otcinfra check sni req.hdr(Host)"
      - name: "graphite-proxy2"
        address: "192.168.110.151:8082"
        opts: "verify none cookie graphite2 check sni req.hdr(Host)"
      - name: "graphite-web3"
        address: "192.168.2.52:8082"
        opts: "verify none cookie graphite3 check sni req.hdr(Host)"

  - name: "dashboard"
    options:
      - "httpchk HEAD /api/health"
    domain_names:
      - "dashboard.tsi-dev.otc-service.com"
      - "apimon.tsi-dev.otc-service.com"
      - "apimon.eco.tsi-dev.otc-service.com"
    servers:
      - name: "web3"
        address: "192.168.2.52:3000"
        opts: "check cookie web3"
      - name: "dashboard.infra.eco.tsi-dev.otc-service.com"
        address: "dashboard.infra.eco.tsi-dev.otc-service.com:443"
        opts: "ssl verify none cookie infra check sni req.hdr(Host)"
      - name: "dashboard.apps.osinfra-mirror.eco.tsi-dev.otc-service.com"
        address: "dashboard.apps.osinfra-mirror.eco.tsi-dev.otc-service.com:443"
        opts: "ssl verify none cookie osinfra-mirror check sni req.hdr(Host)"

  - name: "alerta"
    options:
      # NOTE: trailing slash avoids redirect
      - "httpchk GET /api/"
    domain_names:
      - "alerts.eco.tsi-dev.otc-service.com"
    servers:
      - name: "web3"
        address: "192.168.2.52:8080"
        opts: "check cookie web3"
      - name: "alerta.infra.eco.tsi-dev.otc-service.com"
        address: "alerta.infra.eco.tsi-dev.otc-service.com:443"
        opts: "ssl verify none cookie infra check sni req.hdr(Host)"
      - name: "alerta.apps.osinfra-mirror.eco.tsi-dev.otc-service.com"
        address: "alerta.apps.osinfra-mirror.eco.tsi-dev.otc-service.com:443"
        opts: "ssl verify none cookie osinfra-mirror check sni req.hdr(Host)"

  - name: "influx"
    domain_names:
      - "influx1.eco.tsi-dev.otc-service.com"
    servers:
      - name: "influx1"
        address: "192.168.110.227:8086"
        opts: "check"

proxy_frontends:
  - name: "influx"
    bind: "*:8086 ssl crt /etc/ssl/{{ inventory_hostname }}/haproxy"
    backend: "influx"

statsd_host: "192.168.14.159"
statsd_port: "8125"
