# Database configuration
vault kv put secret/backstage/database \
  host="postgres.backstage.svc.cluster.local" \
  port="5432" \
  username="backstage" \
  password="your-secure-database-password"

# Auth configuration
vault kv put secret/backstage/auth \
  github_client_id="your-github-app-client-id" \
  github_client_secret="your-github-app-client-secret"

# Integration tokens
vault kv put secret/backstage/integrations \
  github_token="ghp_your-github-personal-access-token" \
  gitlab_token="glpat-your-gitlab-access-token"

# App configuration
vault kv put secret/backstage/config \
  backend_secret="$(openssl rand -base64 32)" \
  catalog_token="$(openssl rand -base64 32)"


# Create backstage policy
vault policy write backstage - <<EOF
path "secret/data/backstage/*" {
  capabilities = ["read"]
}

path "secret/metadata/backstage/*" {
  capabilities = ["list"]
}
EOF


# Create Kubernetes auth role for backstage
vault write auth/kubernetes_otcinfra2/role/backstage \
  bound_service_account_names=backstage \
  bound_service_account_namespaces=backstage,backstage-dev \
  policies=backstage \
  ttl=24h
