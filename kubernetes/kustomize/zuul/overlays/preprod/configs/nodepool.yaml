---
# Nodepool configuration for Zuul preprod environment
# Debian-only configuration - simplified to single Debian Bookworm image

elements-dir: /etc/nodepool/elements
images-dir: /opt/nodepool/images

zookeeper-servers:
  - host: zookeeper.zuul.svc.cluster.local
    port: 2281

zookeeper-tls:
  cert: /tls/client/tls.crt
  key: /tls/client/tls.key
  ca: /tls/client/ca.crt

labels:
  - name: debian
    min-ready: 1
    max-ready-age: 3600

  - name: pod-debian
    min-ready: 0

  - name: pod-fedora-latest
    min-ready: 0

  - name: ubuntu-jammy
    min-ready: 0

providers:
  # OpenStack providers for VM-based nodes
  - name: otcci-pool1
    driver: openstack
    cloud: otcci-pool1
    boot-timeout: 300
    launch-timeout: 600
    launch-retries: 3
    image-name-format: '{image_name}-{timestamp}'
    rate: 1.0
    diskimages:
      - name: debian-bookworm
        config-drive: true
    pools:
      - name: main
        max-servers: 10
        labels:
          - name: debian
            diskimage: debian-bookworm
            flavor-name: s3.medium.4
            key-name: nodepool

  # Kubernetes provider for pod-based nodes (in-cluster)
  - name: preprod-k8s
    driver: kubernetes
    max-servers: 20
    pools:
      - name: default
        labels:
          - name: pod-debian
            type: pod
            image: quay.io/opentelekomcloud/zuul-executor:11.1.0
            cpu: 0.5
            memory: 512
            python-path: /usr/local/bin/python3

diskimages:
  - name: debian-bookworm
    formats:
      - raw
    rebuild-age: 86400
    env-vars:
      TMPDIR: /opt/dib_tmp
      DIB_CHECKSUM: '1'
      DIB_IMAGE_CACHE: /opt/dib_cache
      DIB_APT_LOCAL_CACHE: '0'
      DIB_DISABLE_APT_CLEANUP: '1'
      DIB_DISTRIBUTION_MIRROR: http://deb.debian.org/debian
      DIB_RELEASE: bookworm
    elements:
      - debian-minimal
      - vm
      - simple-init
      - growroot
      - openssh-server
      - nodepool-base
# Test for PR 1481 check pipeline
# Test after zuul-jobs load-branch fix
# Test after otc-tox parent fix
# Test after changing otc-tox to inherit from unittests
