apiVersion: v1
kind: ConfigMap
metadata:
  name: docsportal-swiss-internal-oauth-proxy-config
data:
  oauth2-proxy.cfg: |
    http_address = "0.0.0.0:4180"
    provider = "oidc"
    redirect_url = "https://docs-swiss-int.eco-preprod.tsi-dev.otc-service.com/oauth2/callback"
    whitelist_domains = [
        "docs-swiss-int.eco-preprod.tsi-dev.otc-service.com"
    ]
    email_domains = [
        "*"
    ]
    upstreams = [
        "http://document-hosting:8080"
    ]
    session_store_type = "redis"
    redis_connection_url = "redis://redis:6379"
    cookie_secure = true
    cookie_httponly = true
    cookie_samesite = "lax"
    insecure_oidc_allow_unverified_email = true
    client_id = "<path:secret/data/helpcenter/swiss/internal/oidc#client_id>"
    client_secret = "<path:secret/data/helpcenter/swiss/internal/oidc#client_secret>"
    cookie_secret = "<path:secret/data/helpcenter/swiss/internal/oidc#cookie_secret>"
    oidc_issuer_url = "https://zitadel.eco.tsi-dev.eco-preprod.tsi-dev.eco-preprod.tsi-dev.otc-service.com/realms/eco"
    # Temporarily remove group restriction for testing
    # allowed_groups = [
    #     "/hc-swiss-internal"
    # ]
