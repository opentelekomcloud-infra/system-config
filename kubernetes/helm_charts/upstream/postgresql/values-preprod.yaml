# PostgreSQL Helm Chart - Preprod Configuration
# Minimal working configuration
postgresql:
  global:
    defaultStorageClass: "csi-disk"

  # Authentication configuration using ArgoCD Vault Plugin
  auth:
    enablePostgresUser: true
    postgresPassword: "<path:secret/data/postgresql/admin#postgres-password>"
    usePasswordFiles: true

  # Security hardening
  image:
    pullPolicy: IfNotPresent
    debug: false

  # Primary database configuration
  primary:
    name: primary

    # Security context
    podSecurityContext:
      enabled: true
      fsGroup: 1001
      runAsUser: 1001
      runAsNonRoot: true

    containerSecurityContext:
      enabled: true
      runAsUser: 1001
      runAsNonRoot: true
      allowPrivilegeEscalation: false
      readOnlyRootFilesystem: false  # Keep false for PostgreSQL to work

    # Resource limits for security and stability
    resources:
      limits:
        memory: "2Gi"
        cpu: "1000m"
      requests:
        memory: "1Gi"
        cpu: "500m"

    # Persistence configuration
    persistence:
      enabled: true
      storageClass: "csi-disk"
      accessModes:
        - ReadWriteOnce
      size: 50Gi

  # Service configuration
  service:
    type: ClusterIP
    ports:
      postgresql: 5432
