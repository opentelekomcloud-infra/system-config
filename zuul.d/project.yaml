- project:
    merge-mode: squash-merge
    check:
      jobs:
        - otc-tox-linters
        - system-config-run-base
        - system-config-run-statsd
        - system-config-run-acme-ssl
        - system-config-run-x509-cert
        - system-config-run-apimon-epmon
        - system-config-run-apimon-scheduler
        - system-config-run-apimon-executor
        - system-config-run-graphite
        - system-config-run-memcached
        - system-config-run-alerta
        - system-config-run-grafana
        - system-config-run-proxy
        - system-config-build-image-zookeeper-statsd
    gate:
      jobs:
        - otc-tox-linters
        - system-config-run-base
        - system-config-run-statsd
        - system-config-run-acme-ssl
        - system-config-run-x509-cert
        - system-config-run-apimon-epmon
        - system-config-run-apimon-scheduler
        - system-config-run-apimon-executor
        - system-config-run-graphite
        - system-config-run-memcached
        - system-config-run-alerta
        - system-config-run-grafana
        - system-config-run-proxy
        - system-config-upload-image-zookeeper-statsd
    deploy:
      jobs:
        - infra-prod-install-ansible
        - infra-prod-base
        - infra-prod-service-bridge
        - infra-prod-service-acme-ssl
        # - infra-prod-service-x509-cert
        - infra-prod-service-statsd
        - infra-prod-service-apimon-epmon
        - infra-prod-service-apimon-scheduler
        - infra-prod-service-apimon-executor
        - infra-prod-service-apimon-k8s
        # memcached should come before graphite
        - infra-prod-service-memcached
        - infra-prod-service-graphite
        - infra-prod-service-alerta
        - infra-prod-service-alerta-k8s
        - infra-prod-service-grafana
        - infra-prod-service-grafana-k8s
        - infra-prod-service-proxy
        - infra-prod-dashboards
        - infra-prod-manage-github:
            files:
              - playbooks/manage-github.yaml
              - playbooks/roles/gitcontrol
              - playbooks/templates/github/default_zuul.yaml
            dependencies:
              - name: infra-prod-install-ansible
                soft: true
    periodic:
      # Nightly execution
      jobs:
        - infra-prod-install-ansible
        - infra-prod-base
        - infra-prod-service-bridge
        - infra-prod-service-acme-ssl
        # - infra-prod-service-x509-cert
        - infra-prod-service-grafana-dashboards
        - infra-prod-service-statsd
        - infra-prod-service-apimon-epmon
        - infra-prod-service-apimon-scheduler
        - infra-prod-service-apimon-executor
        - infra-prod-service-apimon-k8s
        - infra-prod-service-memcached
        - infra-prod-service-graphite
        - infra-prod-service-alerta
        - infra-prod-service-alerta-k8s
        - infra-prod-service-grafana
        - infra-prod-service-grafana-k8s
        - infra-prod-service-proxy
    periodic-hourly:
      # hourly execution
      jobs:
        - infra-prod-install-ansible
        - infra-prod-service-bridge:
            dependencies:
              - name: infra-prod-install-ansible
                soft: true
