---
- project:
    merge-mode: squash-merge
    default-branch: main
    templates:
      - publish-otc-docs-pti
    check:
      jobs:
        - otc-tox-linters
        - system-config-run-base
        - system-config-run-statsd
        - system-config-run-acme-ssl
        - system-config-run-x509-cert
        - system-config-run-apimon-epmon
        - system-config-run-apimon-scheduler
        - system-config-run-apimon-executor
        - system-config-run-graphite
        - system-config-run-memcached
        - system-config-run-alerta
        - system-config-run-grafana
        - system-config-run-proxy
        - system-config-run-vault
        - system-config-run-zookeeper
        - system-config-build-image-zookeeper-statsd
        - system-config-build-image-graphite-statsd
        - system-config-build-image-haproxy-statsd
    gate:
      jobs:
        - otc-tox-linters
        - system-config-run-base
        - system-config-run-statsd
        - system-config-run-acme-ssl
        - system-config-run-x509-cert
        - system-config-run-apimon-epmon
        - system-config-run-apimon-scheduler
        - system-config-run-apimon-executor
        - system-config-run-graphite
        - system-config-run-memcached
        - system-config-run-alerta
        - system-config-run-grafana
        - system-config-run-proxy
        - system-config-run-vault
        - system-config-run-zookeeper
        - system-config-upload-image-zookeeper-statsd
        - system-config-upload-image-graphite-statsd
        - system-config-upload-image-haproxy-statsd
    deploy:
      jobs:
        - infra-prod-install-ansible
        - infra-prod-base
        - infra-prod-service-bridge
        - infra-prod-install-cce
        - infra-prod-install-helm-chart
        - infra-prod-service-acme-ssl
        - infra-prod-service-loki
        # - infra-prod-service-x509-cert
        - infra-prod-service-statsd
        - infra-prod-service-apimon-epmon
        - infra-prod-service-apimon-scheduler
        - infra-prod-service-apimon-executor
        - infra-prod-service-apimon-k8s
        # memcached should come before graphite
        - infra-prod-service-memcached
        - infra-prod-service-graphite
        - infra-prod-service-alerta
        - infra-prod-service-grafana
        - infra-prod-service-docs
        - infra-prod-service-proxy
        - infra-prod-service-vault
        - infra-prod-service-zookeeper
        - infra-prod-service-octavia-proxy
        - infra-prod-dashboards
    periodic:
      # Nightly execution
      jobs:
        - infra-prod-install-ansible
        - infra-prod-base
        - infra-prod-service-bridge
        - infra-prod-install-cce
        - infra-prod-install-helm-chart
        - infra-prod-service-acme-ssl
        - infra-prod-service-loki
        # - infra-prod-service-x509-cert
        - infra-prod-service-grafana-dashboards
        - infra-prod-service-statsd
        - infra-prod-service-apimon-epmon
        - infra-prod-service-apimon-scheduler
        - infra-prod-service-apimon-executor
        - infra-prod-service-apimon-k8s
        - infra-prod-service-memcached
        - infra-prod-service-graphite
        - infra-prod-service-alerta
        - infra-prod-service-grafana
        - infra-prod-service-docs
        - infra-prod-service-proxy
        - infra-prod-service-zookeeper
    periodic-hourly:
      # hourly execution
      jobs:
        - infra-prod-install-ansible
        - infra-prod-service-bridge:
            dependencies:
              - name: infra-prod-install-ansible
                soft: true
