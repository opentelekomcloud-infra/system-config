- job:
    name: system-config-run
    description: |
      Run the "base" playbook for system-config hosts.

      This is a parent job designed to be inherited.
    abstract: true
    pre-run: playbooks/zuul/run-base-pre.yaml
    run: playbooks/zuul/run-base.yaml
    post-run: playbooks/zuul/run-base-post.yaml
    vars:
      install_ansible_ara_enable: false
      zuul_copy_output: "{{ copy_output | combine(host_copy_output | default({})) }}"
      stage_dir: "{{ ansible_user_dir }}/zuul-output"
      copy_output:
        '/var/log/syslog': logs_txt
        '/var/log/messages': logs_txt
        '/var/log/docker': logs
        '/var/log/containers': logs
    host-vars:
      bridge.eco.tsi-dev.otc-service.com:
        host_copy_output:
          '{{ zuul.project.src_dir }}/junit.xml': logs
          '{{ zuul.project.src_dir }}/test-results.html': logs
          '{{ zuul.project.src_dir }}/inventory/base/gate-hosts.yaml': logs
          '/var/log/screenshots': logs

- job:
    name: system-config-run-base
    parent: system-config-run
    description: |
      Run the "base" playbook on each of the node types
      currently in use.
    nodeset:
      nodes:
        - name: bridge.eco.tsi-dev.otc-service.com
          label: ubuntu-focal
        - name: f32
          label: fedora-32
    files:
      - tox.ini
      - playbooks/
      - roles/
      - testinfra/

- job:
    name: system-config-run-statsd
    parent: system-config-run
    description: |
      Run the "statsd" playbook on each of the node types
      currently in use.
    nodeset:
      nodes:
        - name: bridge.eco.tsi-dev.otc-service.com
          label: ubuntu-focal
        - name: f31.statsd
          label: fedora-31
        - name: f32.statsd
          label: fedora-32
    vars:
      run_playbooks:
        - playbooks/service-statsd.yaml
    files:
      - tox.ini
      - playbooks/
      - roles/
      - testinfra/
